# Comunicazione sicura: i protocolli crittografici

## Definizione del contesto

### Comunicazione sicura lungo un canale insicuro

Indichiamo con la parola **canale** il mezzo tramite il quale due entita' possono comunicare.
Quando il canale e' accessibile anche ad altre entita', oltre a quelle che vogliono comunicare tra di loro, allora il canale si dice **insicuro**.
Poiche' internet e' un canale diviso tra moltissimi utenti, e' definitivamente un canale insicuro.

Nella comunicazione tra persone, browser/server, online banking client/server, router, e' necessario che le informazioni scambiate tra le due entita' siano **protette** e che queste identita' siano **autenticate** per verificarne l'identita'.

#### Comunicazione sicura
Per fare in modo che una comunicazione sia sicura, attraverso un canale insicuro come Internet dobbiamo stabilire delle proprieta' di sicurezza che devono essere garantite durante la comunicazione:
* **Confidenzialita'**: solo Alice e Bob devono poter "capire" il contenuto dei messaggi;
* **Integrita'**: i messaggi non devono venire modificati;
* **Autenticazione**: Alice e Bob devono essere sicuri che il loro interlocutore sia effettivamente chi dice di essere (e che loro si aspettano);
* **Non-repudiation**: Alice non puo' negare di aver spedito un messaggio a Bob.

#### Autenticazione nella rete
Quando si effettuano comunicazioni nella rete e' necessario specificare cosa si intenda autenticare.

##### Entity Authentication
Garantisce l'identita' dell'utente che in tempo reale sta comunicando all'interno di una specifica sessione di protocollo.

##### Message Authentication
Garantisce che il messaggio ricevuto proviene dalla sorgente indicata, senza dare alcuna indicazione di quando il messaggio sia stato effettivamente creato.

___

### Tipologia di attaccante

L'attaccante (Trudy) e' un **host malevolo** connesso ad Internet che puo' voler modificare il normale comportamento dei protocolli per scopi illeciti.

#### Protocolli TCP/IP
Alice e Bob sono due entita' che utilizzano Internet come canale di comunicazione, quindi usano i protocolli dello stack TCP/IP.

| n 	| Internet          	| ISO/OSI 7 layer model 	| n 	|
|---	|-------------------	|-----------------------	|---	|
|   	|                   	| Application           	| 7 	|
| 5 	| Application       	| Presentation          	| 6 	|
|   	|                   	| Session               	| 5 	|
| 4 	| TCP               	| Transport             	| 4 	|
| 3 	| IP                	| Network               	| 3 	|
| 2 	| Network Interface 	| Data Link>            	| 2 	|
| 1 	| Hardware          	| Physical              	| 1 	|

>I protocolli di comunicazione definiscono il formato, l'ordine dei messaggi spediti e ricevuti tra le entita' della rete, e le azioni intraprese dopo la trasmissione/ricezione

#### Cosa puo' fare un attaccante
In genere un attaccante puo' essere definito **attivo/passivo** a seconda di cosa puo' fare lungo un canale di comunicazione.
Rimanendo in ascolto lungo il canale puo' intercettare il messaggio (minacciando la confidenzialita') per poi:
* Leggere solamente il messaggio (passivo);
* Effettuare azioni sul messaggio (attivo):
  * Cancellare il messaggio senza inoltrarlo al destinatario;
  * Modificare i messaggi in transito (minaccia all'integrita');
  * Puo' spedire messaggi arbitrari (minaccia all'autenticazione);
  * Puo' riutilizzare vecchi messaggi salvati, tramite un **replay attack** (minaccia all'autenticazione).

#### Contromisure
Per impedire a Trudy di modificare il funzionamento del protocollo, e' necessario crittografare il messaggio (tramite delle **primitive crittografiche**) per continuare a garantire la confidenzialita' e fare in modo che solo Alice e Bob lo possano decifrare.

La segretezza puo' pero' non essere sufficiente per garantire anche l'autenticazione e l'integrita'.

Per fare in modo che un protocollo sia del tutto sicuro, e dunque vengano garantite tutte le proprieta' di sicurezza, sara' necessario usare una combinazione di primitive crittografiche e costruire un **protocollo di sicurezza**.

___

## Introduzione alla crittografia

### Storia della crittografia

___

### Proprieta' degli algoritmi di cifratura

Alice vuole mandare un messaggio m a Bob, mentre Trudy e' l'attaccante passivo (puo' leggere il messaggio M):
* Alice da in input all'**algoritmo di codifica** la chiave di codifica insieme al messaggio in chiaro, ottenendo il messaggio cifrato;
* Alice spedisce il messaggio cifrato a Bob attraverso il canale;
* Bob applica l'**algoritmo di decodifica** con la chiave di decodifica insieme messaggio cifrato, ottenendo il messaggio in chiaro.

#### Principio di Kerchoff
La proprieta' di un buon algoritmo di cifratura/decifratura e' sintetizzata dal **principio di Kerchoff**:
> La sicurezza e' data dalla robustezza dell'algoritmo e dalla segretezza della chiave, non della segretezza dell'algoritmo.

Per questo, nel caso precedente, Trudy puo' avere accesso al canale, dunque ai messaggi, ed essere a conoscenza dell'algoritmo di cifratura, in quanto la sicurezza e' garantita dal possesso delle chiavi di cifratura/decifratura.

In particolare valgono le seguenti affermazioni:
* **E**: funzione codifica;
* **D**: funzione decodifica;
* **m**: messaggio;
* **x**: messaggio cifrato;
* **K**: chiave per la cifratura;
* **K'**: chiave per la decifratura.

> D<sub>K'</sub>(E<sub>K</sub>(m)) == m

> E<sub>K</sub>(m) e' semplice da calcolare, dati m e K

> D<sub>K'</sub>(x) e' semplice da calcolare, dati x e K', ma per Trudy deve essere molto difficile da calcolare (in quanto non possiede K')

> Se x == E<sub>K</sub>(m), e' difficile trovare m senza K

#### Lunghezza delle chiavi
Per quanto possa essere valido un algoritmo crittografico, esso puo' essere forzato provando a decifrare il messaggio con tutte le chiavi possibili tramite un attacco bruteforce.

Per questo motivo, il numero delle chiavi possibili deve essere grande a sufficienza per rendere computazionalmente impossibile questo attacco.
Se scelgo una chiave di *n* bit, lo spazio delle chiavi sara' 2<sup>n</sup>.

#### Gestione di messaggi molto lunghi

##### Block ciphers
Algoritmo che suffivide il messaggio in blocchi di lunghezza predefinita e li cifra/decifra uno alla volta con la stessa chiave (aggiungendo dei bit finali all'ultimo blocco). Tipicamente un blocco e' di 64 bit.

##### Stream ciphers
Algoritmo che cifra il messaggio 1 bit o 1 byte alla volta usando una sequenza denominata **keystream** generata randomicamente a partire dalla chiave o dal messaggio.
___

### Crittografia a chiave simmetrica e asimmetrica

#### Crittografia simmetrica
Se si utilizza la stessa chiave per la codifica e la decodifica allora si tratta di crittografia a chiave simmetrica o a chiave segreta: infatti la segretezza e l'integrita' sono garantite proprio da quest'ultima.

Se Trudy venisse a conoscenza della chiave segreta, potrebbe:
* Produrre nuovi messaggi a nome di Alice o di Bob;
* Leggere tutti i messaggi trasmessi;

Le implementazioni di algoritmi per la crittografia simmetrica sono in genere molto veloci (esistono **implementazioni hardware**) e usano chiavi relativamente corte (64-256 bit), inoltre possono essere utilizzati per la generazione di numeri casuali.

Gli svantaggi sono legati alla gestione e la distribuzione delle chiavi, in quanto:
* La chiave deve essere segreta, e rimanere tale;
* E' necessario che le parti che devono comunicare condividano a priori la chiave segreta da utilizzare per la comunicazione;
* Per evitare gli attacchi bruteforce e' utile cambiare spesso la chiave riproducendo pero' il problema della distribuzione.

La crittografia simmetrica viene utilizzata in diversi ambiti e con diversi obiettivi, in particolare per garantire confidenzialita' e integrita' con il problema di dover **scambiare prima la chiave lungo un canale sicuro**.
Viene usata anche per la memorizzazione sicura su media insicuri (filesystem criptati) e per l'autenticazione con protocollo challenge-response.

##### Gestione delle chiavi
Nel caso in cui ci siano *n* utenti che vogliono parlare tra di loro in modo sicuro,ciascuna coppia di utenti ha bisogno di una chiave il che porta ad un numero polinomiale (n(n-1)/2) di chiavi che si devono scambiare in modo sicuro mediante:
* Scambio fisico;
* Canale sicuro.
Poiche' non e' certo che tutti gli *n* utenti parlino tra di loro, l'algoritmo e' inefficiente.

###### KDC - Key Distribution Center
Il Key Distribution Center e' da considerarsi la *n+1*esima **parte fidata** in un gruppo di *n* utenti, e si occupa di **generare le chiavi** per ogni coppia che le richiede (questo presuppone che gli utenti debbano condividere a priori una chiave con il KDC, per un totale di *n* chiavi totali iniziali).
Con la tecnica del KDC si ha un algoritmo piu' efficiente in quanto il numero di chiavi da scambiare inizialmente non e' polinomiale al numero di utenti totali.

I problemi sono:
* Il KDC deve essere fidato;
* Il KDC diventa un collo di bottiglia e unico punto di fallimento;
* Distribuire inizialmente le chiavi tra gli *n* utenti e il KDC.

Se l'utente U<sub>1</sub> vuole parlare con l'utente U<sub>2</sub>:
* U<sub>1</sub> -> KDC: "Collegami a U<sub>2</sub>";
* KDC genera la nuova chiave K<sub>1-2</sub>;
* KDC -> U<sub>1</sub>: E<sub>K<sub>1</sub></sub>(K<sub>1-2</sub>);
* KDC -> U<sub>2</sub>: E<sub>K<sub>2</sub></sub>(K<sub>1-2</sub>, "U<sub>1</sub> vuole parlare con te").

##### Algoritmi a chiave simmetrica famosi
* DES - Data Encryption Standard;
  * Triple DES (3DES);
* DES-X;
* AES - Advanced Encryption Standard;
* IDEA - International Data Encryption Algorithm;
* RC2;

#### Crittografia asimmetrica
La crittografia asimmetrica (detta anche crittografia a chiave pubblica) utilizza invece due chiavi, una per la codifica, l'altra perl a decodifica.

Ogni utente ha una coppia di chiavi, dunque non e' necessario lo scambio di chiavi iniziale:
* Chiave pubblica: informazione da diffondere;
* Chiave segreta: segreto da custorire.

Tramite la crittografia asimmetrica:
* La segretezza del messaggio e' garantita;
* Sono necessarie meno chiavi, ma e' importante garantire l'autenticita' delle chiavi pubbliche;
* E' possibile garantire integrita' e autenticazione procedendo al contrario (crittando con la propria privata), ma in questo modo la segretezza non e' piu' garantita in quanto chiunque possieda la chiave pubblica puo' leggere.

Tendenzialmente la crittografia asimmetrica, rispetto a quella simmetrica, e' piu' lenta e usa chiavi piu' lunghe (1024-2048 bit), qunidi inefficienti per messaggi lunghi.

>La best practice prevede l'utilizzo di chiavi asimmetriche per lo scambio di chiavi simmetriche.


##### Algoritmi a chiave asimmetrica famosi
* RSA
* Crittosistema di Rabin
* ElGamal

___

### Funzioni hash

___

### Firma digitale

___

### Certificato digitale